{
    "componentChunkName": "component---src-templates-md-template-js",
    "path": "/blogs/backend-services-case-study",
    "result": {"data":{"markdownRemark":{"html":"<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#application-1---a-web-ui-application\">Application 1 - A Web UI Application</a></p>\n<ul>\n<li><a href=\"#overview\">Overview</a></li>\n<li><a href=\"#tpsqps\">TPS/QPS</a></li>\n<li><a href=\"#latency-region-1-1min-dp\">Latency (region 1, 1min dp)</a></li>\n<li><a href=\"#critical-dependencies-region-1\">Critical Dependencies (region 1)</a></li>\n<li><a href=\"#billing-region-1\">Billing (region 1)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#application-2---aws-heavy-application\">Application 2 - AWS-Heavy Application</a></p>\n<ul>\n<li><a href=\"#overview-1\">Overview</a></li>\n<li><a href=\"#tpsqps-and-latency-region-1\">TPS/QPS and Latency (region 1)</a></li>\n<li><a href=\"#critical-dependencies-and-billing-region-1\">Critical Dependencies and Billing (region 1)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#application-3---dynamodb-intensive-application\">Application 3 - DynamoDB Intensive Application</a></p>\n<ul>\n<li><a href=\"#overview-2\">Overview</a></li>\n<li><a href=\"#tpsqps-and-latency-region-1-1\">TPS/QPS and Latency (region 1)</a></li>\n<li><a href=\"#billing-region-1-1\">Billing (region 1)</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"application-1---a-web-ui-application\" style=\"position:relative;\"><a href=\"#application-1---a-web-ui-application\" aria-label=\"application 1   a web ui application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Application 1 - A Web UI Application</h2>\n<h3 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h3>\n<p>A UI application with Java Spring-based backend and JSP (migrating to React) frontend hosted on Tomcat server. Stateless application, using session Id tracked in cookies to retrieve/store session date from DynamoDB.</p>\n<p>The application provides users a UI illustrating directed workflows to achieve business purposes. The frontend-backend interaction follows \"single API pattern\":\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 980px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8895e01dc7349af604f9e952f700b6c4/151cf/backend-frontend.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.69387755102041%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdqmhlh//8QAGhAAAgIDAAAAAAAAAAAAAAAAAAECIRExQf/aAAgBAQABBQJPJsskq4f/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAADAAMAAAAAAAAAAAAAAAAAARARMVH/2gAIAQEABj8Czo5GKf/EABsQAQEAAQUAAAAAAAAAAAAAAAEAQRARMWGR/9oACAEBAAE/Ico9GFgUcEDuGIPHT//aAAwDAQACAAMAAAAQwA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxBn/8QAHxAAAgICAQUAAAAAAAAAAAAAAREAITFBURBhcZHR/9oACAEBAAE/ENVCkNEVsRlRAc5fyOiPJhOA2vYrmBLGUGSe3vp//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"backend-frontend\"\n        title=\"backend-frontend\"\n        src=\"/static/8895e01dc7349af604f9e952f700b6c4/4012a/backend-frontend.jpg\"\n        srcset=\"/static/8895e01dc7349af604f9e952f700b6c4/a0fb2/backend-frontend.jpg 245w,\n/static/8895e01dc7349af604f9e952f700b6c4/6b254/backend-frontend.jpg 490w,\n/static/8895e01dc7349af604f9e952f700b6c4/4012a/backend-frontend.jpg 980w,\n/static/8895e01dc7349af604f9e952f700b6c4/151cf/backend-frontend.jpg 1181w\"\n        sizes=\"(max-width: 980px) 100vw, 980px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>The frontend is simply a \"one-page application\". It receives a json telling it to \"put this text in the textbox with this id in the UI\". This json also enable/disable potential user input components in the UI by providing ID, for example scanner/button. Once user triggered any action, the action ID and it's value will be sent to the backend API.</p>\n<p>The backend receives the request and will fetch session data from DB by the session id in the request. Session data is a list of \"serializable object\" storing the current states. Overall, the backend is a state machine, given the states from session DB, plus user action ID and value, it will compute the next \"step\" of states based on the defined state transition logic. Selected \"next step\" will be sent back to the frontend and will be used for rendering.</p>\n<h3 id=\"tpsqps\" style=\"position:relative;\"><a href=\"#tpsqps\" aria-label=\"tpsqps permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TPS/QPS</h3>\n<p>There are 3 main regions of this application.</p>\n<ul>\n<li>Region 1: there are 24.5M of \"Unit-of-Work\" every day and 6.2% of them are processed by this app, about 1.5M/Day. TPS is 61(MAX, 1 min dp), 25(MIN, 1min dp) and 45(AVG, 1min dp)</li>\n<li>Region 2: there are 10M of \"Unit-of-Work\" every day and 10% of them are processed by this app, about 1M/Day. TPS is 32(MAX, 1 min dp), 3(MIN, 1min dp) and 17(AVG, 1min dp)</li>\n<li>Region 3: there are 2.2M of \"Unit-of-Work\" every day and 3% of them are processed by this app, about 67K/Day. TPS is 4(MAX, 1 min dp), ~0(MIN, 1min dp) and 1.3(AVG, 1min dp)</li>\n</ul>\n<h3 id=\"latency-region-1-1min-dp\" style=\"position:relative;\"><a href=\"#latency-region-1-1min-dp\" aria-label=\"latency region 1 1min dp permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Latency (region 1, 1min dp)</h3>\n<blockquote>\n<p>\"AVG Stat\" means the datapoints are calculated as the avg of datapoints in 1 min</p>\n</blockquote>\n<ul>\n<li>AVG Stat: 742ms; MAX: 1042ms; MIN: 583ms</li>\n<li>p90 Stat: AVG: 1585ms</li>\n<li>p99 Stat: AVG: 2786ms</li>\n</ul>\n<h3 id=\"critical-dependencies-region-1\" style=\"position:relative;\"><a href=\"#critical-dependencies-region-1\" aria-label=\"critical dependencies region 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Critical Dependencies (region 1)</h3>\n<h4 id=\"dynamodb-for-session-data\" style=\"position:relative;\"><a href=\"#dynamodb-for-session-data\" aria-label=\"dynamodb for session data permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DynamoDB for Session Data</h4>\n<ul>\n<li>WCU(/s): Min: 14.175; Max: 75.46; Average: 51.204</li>\n<li>RCU(/s): Min: 46.309; Max: 243.06; Average: 165.63</li>\n<li>Latency:\n<ul>\n<li>Get: 1.6ms</li>\n<li>Put: 3.5ms</li>\n</ul>\n</li>\n<li>Item count (with 12 hours TTL): 41K</li>\n<li>Table size: 155 megabytes</li>\n<li>Avg item size: 3780 bytes</li>\n<li>Point-in-time recovery: Enabled</li>\n<li>GSI/LSI: None</li>\n</ul>\n<h3 id=\"billing-region-1\" style=\"position:relative;\"><a href=\"#billing-region-1\" aria-label=\"billing region 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Billing (region 1)</h3>\n<ul>\n<li>EC2 usage: Unknown\n<ul>\n<li><code class=\"language-text\">21</code> m5-xlarge hosts</li>\n<li>CPU usage is around 10%</li>\n</ul>\n</li>\n<li>Session Data DynamoDB: $620/month, with provisioned RCU as 274 and WCU as 895</li>\n<li>CloudWatch: $45,797.97/month (reason: unknown)</li>\n<li>Lambda (used for one usecase in this app):\n<ul>\n<li>Every 1 min, will be triggered once, 1460 invocations/day</li>\n<li>Duration is 20s in AVG</li>\n<li>$25/month</li>\n</ul>\n</li>\n<li>Another DynamoDB:\n<ul>\n<li>Item Count: 105,720,519</li>\n<li>Table Size: 16.1 Gigabytes</li>\n<li>Average item size: 152.02 bytes</li>\n<li>WCU/s: ~50</li>\n<li>RCU/s: ~0</li>\n<li>Billing: $162/month</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"application-2---aws-heavy-application\" style=\"position:relative;\"><a href=\"#application-2---aws-heavy-application\" aria-label=\"application 2   aws heavy application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Application 2 - AWS-Heavy Application</h2>\n<h3 id=\"overview-1\" style=\"position:relative;\"><a href=\"#overview-1\" aria-label=\"overview 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h3>\n<p>Application 2 heavily depends on AWS services. Its clients push messages into SNS-SQS input buffer, then application 2 fetches messages from SQS and do aggregation on the message then push to different destination in AWS.</p>\n<h3 id=\"tpsqps-and-latency-region-1\" style=\"position:relative;\"><a href=\"#tpsqps-and-latency-region-1\" aria-label=\"tpsqps and latency region 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TPS/QPS and Latency (region 1)</h3>\n<ul>\n<li>API-1:\n<ul>\n<li>TPS: AVG: 463; MAX: 750; MIN: 100;</li>\n<li>Latency: AVG: 180ms; p99: 355ms</li>\n</ul>\n</li>\n<li>API-2: TPS: AVG: 2; Latency: AVG: ~200ms;</li>\n<li>API-3: TPS: AVG: 2; Latency: AVG: ~100ms;</li>\n<li>API-4: TPS: AVG: 3; Latency: AVG: ~200ms;</li>\n<li>API-5: TPS: AVG: 266; latency: AVG: 75ms;</li>\n<li>API-6: TPS: AVG: 5; latency: AVG: ~500ms;</li>\n</ul>\n<h3 id=\"critical-dependencies-and-billing-region-1\" style=\"position:relative;\"><a href=\"#critical-dependencies-and-billing-region-1\" aria-label=\"critical dependencies and billing region 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Critical Dependencies and Billing (region 1)</h3>\n<ul>\n<li>CloudWatch: 87 Dashboards: $267/month</li>\n<li>Cognito: 183 users: $2.75/month</li>\n<li>Data Tranfer\n<ul>\n<li>Data transfer in per month: 5689.145GB: $0</li>\n<li>regional data transfer - in/out/between EC2 AZs or using elastic IPs or ELB: 3272.145GB: $32.72</li>\n<li>first 10TB/month data transfer out: 1024GB: $921</li>\n<li>next 40TB/month data transfer out: 19544.948GB: $1661.32</li>\n</ul>\n</li>\n<li>DynamoDB: 18.455GB data, 458 RCU/s, 2ZWCU/s\n<ul>\n<li>521,570.000 ReadCapacityUnit-Hrs: $67.8</li>\n<li>26,040.000 WriteCapacityUnit-Hrs: $16.93</li>\n<li>25GB free GB-Months free tier: $0</li>\n<li>PITR Storage: $3.52</li>\n</ul>\n</li>\n<li>Kinesis Firehose: 14,388.931 GB data ingested\n<ul>\n<li>$417.28</li>\n</ul>\n</li>\n<li>OpenSearch Service:\n<ul>\n<li>Data nodes: 36 nodes, m5.2xlarge.search, 1400GiB</li>\n<li>Master nodes: 3 nodes, m5.large.search</li>\n<li>Snapshot: hourly</li>\n<li>Billing: $22,250/month</li>\n</ul>\n</li>\n<li>Redshift:\n<ul>\n<li>$0.250 per Redshift Dense Compute Large (DC2.L) Compute Node-hour (or partial hour)7,430.908 Hrs</li>\n<li>$1857.72/month</li>\n</ul>\n</li>\n<li>SNS: $1365/month\n<ul>\n<li>Note: on average, one request will generate 2 SNS publishing</li>\n</ul>\n</li>\n<li>SQS: $2427.15\n<ul>\n<li>Note: one request one message</li>\n</ul>\n</li>\n<li>S3:\n<ul>\n<li>Amazon Simple Storage Service Requests-Tier1: 0.005 per 1,000 PUT, COPY, POST, or LIST requests1,052,492.000 Requests - $5.26</li>\n<li>Amazon Simple Storage Service Requests-Tier2: 0.004 per 10,000 GET and all other requests956,677.000 Requests - $0.38</li>\n<li>Storage: 85,875.333 GB-Mo - $1940.46/month</li>\n</ul>\n</li>\n<li>In total: $59011.99/month</li>\n</ul>\n<h2 id=\"application-3---dynamodb-intensive-application\" style=\"position:relative;\"><a href=\"#application-3---dynamodb-intensive-application\" aria-label=\"application 3   dynamodb intensive application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Application 3 - DynamoDB Intensive Application</h2>\n<h3 id=\"overview-2\" style=\"position:relative;\"><a href=\"#overview-2\" aria-label=\"overview 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h3>\n<p>This application heavily depends on DynamoDB.</p>\n<h3 id=\"tpsqps-and-latency-region-1-1\" style=\"position:relative;\"><a href=\"#tpsqps-and-latency-region-1-1\" aria-label=\"tpsqps and latency region 1 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TPS/QPS and Latency (region 1)</h3>\n<ul>\n<li>API-1(GET): TPS: AVG: 511; Latency: AVG: 10.19ms; p99: 38ms</li>\n<li>API-2(GET): TPS: AVG: ~1; Latency: AVG: 20ms; p99: 75ms</li>\n<li>API-3(PUT): TPS: AVG: 348; Latency: AVG: 56ms; p99: 172ms</li>\n</ul>\n<h3 id=\"billing-region-1-1\" style=\"position:relative;\"><a href=\"#billing-region-1-1\" aria-label=\"billing region 1 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Billing (region 1)</h3>\n<ul>\n<li>Table 1:\n<ul>\n<li>Item count: 22,413,875,643</li>\n<li>Table size: 14.5 TB</li>\n<li>Average item size: 647.13B</li>\n<li>RCU/s: 17248 (previsioned: 38,670)</li>\n<li>WCU/s: 2067 (prevision: 4550)</li>\n<li>Put latency: -</li>\n<li>Query Latency: 6ms</li>\n</ul>\n</li>\n<li>Table 2:\n<ul>\n<li>Item count: 556,608,790</li>\n<li>Table size: 141.2 gigabytes</li>\n<li>Average item size: 253.72 bytes</li>\n<li>RCU/s: 944 (previsioned: 2225)</li>\n<li>WCU/s: 3.3 (prevision: 20)</li>\n<li>Put latency: -</li>\n<li>Get latency: ~1ms</li>\n</ul>\n</li>\n<li>Table 3:\n<ul>\n<li>Item count: 849,617,771</li>\n<li>Table size: 565.1 gigabytes</li>\n<li>Average item size: 665.09 bytes</li>\n<li>RCU/s: 2074 (previsioned: 4693)</li>\n<li>WCU/s: 216 (prevision: 490)</li>\n<li>Put latency: -</li>\n<li>Get latency: 2ms</li>\n</ul>\n</li>\n<li>Total billing:\n<ul>\n<li>$22,722.04</li>\n</ul>\n</li>\n<li>Additional:\n<ul>\n<li>CloudWatch: $3,849</li>\n</ul>\n</li>\n</ul>","frontmatter":{"date":"June 21, 2022","path":"/blogs/backend-services-case-study","tags":["blog","case study","experience"],"title":"Cases Study on Backend Services","description":"Case study on several services. No garantee on the accuracy."}}},"pageContext":{"prev":{"frontmatter":{"path":"/readings/arduino-engineering-kit-chapter-3-1","tags":["readings","arduino engineering kit","dc motor"],"password":null},"internal":{"content":"\n```toc\n```\n\n## DC Motors\n![dc motor](images/WeChat516bdf43af2c57bd52e4b4e56c01f31c.png)\n### How does it work\n* The DC motor spins when we apply DC voltage through its two terminal pins. \n* We can vary the speed of the motor by changing the voltage level.\n* motors can run freely in both directions just by reversing the direction of the current.\n* **Not** very good for precise movement, but they can provide very high rotational speeds.\n\n### Characterstics of Motors\n1. **Speed**: \n    1. Max speed at no load\n2. **Stall Torque**: \n    1. This is commonly presented in kg-cm and sometimes in Newton-meters, and it gives you a frame of reference for the maximum strength of the motor (i.e., when the motor can no longer rotate because of overload).\n3. **Stall current**:\n    1. The amount of electric current in Amperes that is consumed by the motor under a maximum load (stall).\n4. **Operating voltage**:\n    1. The range of voltages that the motor is designed to work within.\n\n### Driving DC Motors with Arduino\nArduino board is not recommended to connect the output pins of the microcontroller directly to the motor terminals as the motor's current demand can damage the chip.\n\n To control a DC motor from a microcontroller without damaging the microcontroller, you’ll need to use a circuit in between called **driver**. This can be a transistor, a relay or an H-Bridge. The Arduino Nano Motor Carrier uses **H-Bridges** to drive the DC motors.\n\n![dc motor drivers](images/WeChatabcd99aa9dc59c6b97e2d39b4555e669.png)\n\n**H-Bridge**\n\nAn H-Bridge is an electronic circuit that allows us to change the current direction applied to a load. They are commonly used as motor drivers to **change the direction** and **the speed** of a DC motor and to manage the higher power since microcontrollers usually don’t have enough current to power an electric motor. For example, In this kit we will use the H bridges in the Arduino Nano Motor Carrier to provide 12V to our motors while safely controlling them with 3.3V signals from the microcontroller.\n\n![hbridge](images/WeChatf583cfe32c1edca07b8a55497aaeabba.png)\n\nThe H-Bridge contains four transistors arranged so that the current can be driven to control the direction of the spin and the angular speed. These transistors behave as four switches that are controlled in pairs. The current flows in a different direction depending on which switches are activated. This allows the direction of the motor itself to be controlled.\n\n![hbridge-1](images/WeChat959801fcc38e5598b52e306d511643d8.png)\n\n|Signal Control A | Signal Control B | Movement |\n| --------------- | ---------------- | -------- |\n| HIGH | LOW | Clockwise |\n| LOW | HIGH | Counter-Clockwise|\n| LOW | LOW | Slow Stop|\n| HIGH | HIGH | Fast Stop|\n\n### H-Bridges in the kit\n* we have 4 H-Bridges chips located in the top side of the Motor Carrier\n* the chips are controlled through I2C via the SAMD11 microcontroller present in the Motor Carrier\n* This driver has a current sense resistor that limits the amount of current the chip can drive\n* In the Motor carrier, the current is limited to 1.5A\n\n### Controlling Speed\n> PWM, Pulse Width Modulation. This is possible because since the motor cannot change speed so fast, it acts as a **low pass filter** and it behaves as if it is receiving the average (analog) value of the voltage and current being applied.\n\n![PWM](images/WeChat00b80bb135f348c6091cf3c4141ecda4.png)\n\n### PWM in Microcontrollers\nIn the Arduino boards, PWM pins are denoted with a “tilde” ~ symbol next to the pin number. On an Arduino Nano 33 IoT, the pins are 2, 3, 5, 6, 9, 10, 11 and 12.\n\n![pwm in arduino](images/WeChata2af44cd6f37e530cbcb5e48cb738101.png)\n\nArduino API: `analogWrite(255)` -> 100% duty. `analogWrite(127)` -> 50% duty.\n\n\n### Reading Motor Speed\n> Hall effect sensor is capable of detecting the Hall effect. This consists of the production of a voltage difference across an electrical conductor when a magnetic field is applied.\n\nAs the motor turns, the disc rotates past the sensors. Each time a magnetic pole passes a sensor, the encoder outputs a digital pulse, also called a “tick”. By counting the frequency of those ticks, the speed of the motor can be determined.\n\n![motor speed](images/WeChat30004f3d7733839ac85bc4a5ed287ce2.png)\n\nThe encoder has 2 outputs, one for each Hall effect sensor. The sensors are positioned so that there is a phase of 90 degrees between them. This means that the square wave outputs of the two Hall effect sensors on one encoder are 90 degrees out of phase. This is called a quadrature output.\n\n![hall effect](images/WeChat6247af5d36bd8d8a40c6c787289714ef.png)\n\nIf output A is ahead of output B, the motor is turning forward. If output A is behind output B, the motor is turning backward.\n\nBy measuring the frequency of the pulse signal in A or B (in this case it’s not important from which one), we will obtain the speed at which the motor is turning.\n\n### Specs of DC Motors in Kit\n* Micro motor with gear with Encoder\n    * Speed (No load): 320 RPM\n    * Stall Torque: 2.2 Kg-cm\n    * Gear ratio: 100:1\n    * Ticks per revolution (without gearbox): 12\n    * Ticks per revolution (when accounting for gearbox): 1200\n* DC Motor with Encoder\n    * Speed (No load): 7500 RPM\n    * Stall torque: 150g-cm\n* PINs\n    * ![big motor](images/WeChat8422b43f110b224f9549987c5239b1bb.png)\n    * ![small motor](images/WeChated62a2f5a22a08fb88d19711fbf932b3.png)\n    * GND and VCC are for ground and voltage input\n    * OUT A and OUT B are for speed/direction read output\n    * M+ and M- are for the H bridge\n* Arduino Nano Motor Carrier contains a data buffer for each of the two encoder ports. Each time the A or B signal changes from the encoder chip, the value in the data buffer is incremented or decremented by one. The resulting integer value is the encoder count, which we can read any time we need it."}},"next":{"frontmatter":{"path":"/blogs/aspects-of-software-system-auditing-backend","tags":["blog","experience","microservice"],"password":null},"internal":{"content":"\n```toc\n```\n\n## Overall\n* Describe the software's architecture - architecture diagram?\n* Describe the software's use cases?\n* Mechanisms to reduce blast radius\n    * network: environments separation - podding, soak deployment - onebox\n    * bad deployment: testings - unit tests, integration tests, E2E tests\n* Think about the conditions which could cause catastrophes, list the cuases and how long it would take to reach the point of totally failure. Ex: \n    * High dependency API latency causing excessive timeouts\n    * degenerated client call patterns\n    * loss of caching solution\n* List all changes recently could impact scaling, performance, dependencies or clients\n* SOPs runbook, datarecovery mechanism in place?\n\n## Security\n* Is data processed by this service confidential? If yes, how is security maintained in this service?\n* Do certificates have a renew policy?\n\n\n## Architecture\n* What is the \"Unit of work\"?\n    * What is the basic factor of the traffic of the software\n* What is the AZ redundancy?\n    * AZ - Available Zone, a term used in AWS. AZ contains hosts. Hosts in different AZ are in different data center. Catastrophe (for example power loss) happens in one AZ will NOT impact other AZs.\n    * AZ redundency - the software can withstand at least one AZ loss. \n    * Homogeneous is required amoung all AZs\n* Any **throttling** techniques? \n    * How long it will take to change the throttling config?\n* Health Check\n    * Ping check\n    * Carnaval test\n* List down top clients. Alarms, SOPs.\n\n## Monitoring\n* Monitors are recommended to use percentage instead of count\n* Is the deployment connected to auto-rollback monitors?\n\n## Dependencies\n* For data store in the software, any recovery mechanisms in place to recover from lost or corrupted data?\n    * Is there a \"runbook\"?\n    * Is it in theory? Have we tried that in practice?\n    * How long it will take to execute the recovery mechanism?\n* The **timeout** of API should be larger than the sum of timeout of all dependencies get called in this API\n* Impacts when dependency becomes unavailable for certain timerange(5 mins, 30 mins, 3 hours, 1 day)\n* Are your dependencies are able to handle the load from this software?\n* Do we have dependency alarms? - Latency, timeout, throttling, Faults, Errors...\n* SOP of engaging these service dependencies\n* Is extra time required to \"cold restart\" the software?\n* Is there dependency causing reoccuring issue\n* For retrying on dependencies, is there mechanism to stop unnecessary retries? Any possibilities causing \"retry strom\"?\n\n## Infrastructure\n* Alarms on service architecture - CPU, Disk Utilization, Database latencies\n* Is logging managed to reduce the risk on having issue with disk useage?\n    * Logger rate limiting: BurstFilter in Log4j\n    * Disk Space Log Filter: discard log events when free disk space drops below some threshold\n    * Automatic log cleaning mechanism\n    * Discard Policy\n\n## Scaling\n* Chaos testing: load testing against the service with fault-injection framework.\n    * hijack the dependency call and create some timeout\n    * increase the latency\n    * CPU hog test\n    * MEM hog test\n* Any ACL (Access Control List)? Any whitelist/blacklist and what is the effort to change them?\n* What is the network of this service? Internet? Or private network? Any special steps for cold start on new hosts in this network?\n* Load Test result\n    * CPU\n    * MEM\n    * DISK\n    * Latency\n    * ERROR/Failure Rate\n    * Outstanding request (how many threads are running simultaneously on the same hosts? )\n* Based on the reasult, what is the bottleneck?\n* Scaling factor - 2x? 5x? Why?\n\n## DynamoDB\n* How did you determine your service RCU/WCU needs\n* Have you verified that your GSIs are correctly scaled to handle Read and Write traffic? (Note that if a GSI runs out of WCUs it will throttle writes to the main table. For each table, if you are using a GSI how have you allocated sufficient WCUs to take this into account?)\n* What are the per table and per account limits of your DynamoDB account?\n* Did you review the DDB tables and their capacity modes (On-Demand or Provisioned)?\n\n## Relational Database\n* Is an RDBMS your primary data source for this Service? Which provider is it (Oracle, MySQL, Postgres, RDS, etc)?\n* Have you engaged the DBA's to review your RDBMS peak requirements?\n* If your service uses pods, have you confirmed that your DB can handle the total connections from each POD?\n\n## Lambda\n* If using DDB/S3 as triggers, did you test with different batch and record sizes? This will help in increasing the throughput. Ref: https://docs.aws.amazon.com/lambda/latest/dg/best-practices.html#stream-events\n* If you are using provisioned concurrency, did you verify that will not brown out unpublished version of the function?Note: Provisioned concurrency counts towards a function's reserved concurrency and Regional limits. If the amount of provisioned concurrency on a function's versions and aliases adds up to the function's reserved concurrency, all invocations run on provisioned concurrency. This configuration also has the effect of throttling the unpublished version of the function ($LATEST), which prevents it from executing.\n* What is the deployment package size of your Lambda function? You can find this from your AWS console. Limit ref: https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html\n\n## Kinesis\n* While scaling a service that utilizes Kinesis, do you have monitors, metrics, and alarms in place in line with the Kinesis best practices?\n    * https://docs.aws.amazon.com/streams/latest/dev/introduction.html\n    * https://docs.aws.amazon.com/streams/latest/dev/disaster-recovery-resiliency.html\n* Did you load test your Kinesis consumer? https://docs.aws.amazon.com/streams/latest/dev/kinesis-record-processor-scaling.html\n* Do you use Kinesis Client Library (KCL) or Kinesis Producer Library (KPL)?\n* Did you verify the provisioned throughput capacity of your DynamoDB table? For each KCL/KPL application, a unique Amazon DynamoDB table is used to keep track of the application's state. If your application receives provisioned-throughput exceptions,it might be because of the insufficient provisioned throughput of the table.\n    * https://docs.aws.amazon.com/streams/latest/dev/introduction.html\n    *  https://docs.aws.amazon.com/cli/latest/reference/dynamodb/describe-table.html\n* Do you have an sufficient rentention period set for your streams? The default retention period for an AWS Kinesis stream is 24 hours. To ensure that your consumers are able to read stream data before it expires if any problems occur, you can extend your data retention period up to 168 hours (7 days).\n    * https://docs.aws.amazon.com/streams/latest/dev/kinesis-extended-retention.html\n* Do you have the recommended alarms configured for Amazon Kinesis Data Streams\n    * https://docs.aws.amazon.com/streams/latest/dev/monitoring.html\n    * https://docs.aws.amazon.com/streams/latest/dev/monitoring-with-cloudwatch.html\n* Did you override the polling frequency by changing idleTimeBetweenReadsInMillis? If so, how did you verify that this is the ideal value? If this value is set improperly, there can be and increase in exceptions and latency.\n    * https://docs.aws.amazon.com/streams/latest/dev/kinesis-low-latency.html\n\n## ElasticSearch\n* Load testing\n* Are you deploying the domain across three Availability Zones. This configuration lets Amazon ES distribute replica shards to different Availability Zones than their corresponding primary shards. For a list of regions that have three Availability Zones and some other considerations, see [Configuring a Multi-AZ Domain](https://docs.aws.amazon.com/opensearch-service/latest/developerguide/what-is.html)\n\n## API Gateway\n* Have you reviewed your APIGateway API-level throttling limits for peak, and ensured they are adequate to meet your scaling factor for peak traffic?\n    * https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-request-throttling.html\n* If the service employs a usage plan for per client and per-client-per-method throttling, please list the rate, burst limit and quota for each rule.\n* If your API Gateway cache is enabled, list the cache size and TTL for each API and stage. Also list how you determined that this is the appropriate cache size/TTL. If not enabled, please explain why.\n    * https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-caching.html\n\n## SWF\n* Do you have alarms in place to monitor the number of calls to SWF to handle throttling issues?\n* Is your maximum execution history size more than 10k events? The best practice is to structure each workflow such that its history does not grow beyond 10,000 events. The decider has to fetch the workflow history, so a smaller history allows the decider to complete more quickly.\n    * https://docs.aws.amazon.com/amazonswf/latest/developerguide/swf-dg-limits.html#swf-dg-limits-workflow-executions\n    * https://docs.aws.amazon.com/cli/latest/reference/swf/get-workflow-execution-history.html\n* What is the maximum number of pollers your service utilizes per task list? The maximum is 1,000 - but you can encounter LimitExceededException errors well before this quota. To reduce these errors, use multiple task lists to distribute polling.\n    * https://docs.aws.amazon.com/amazonswf/latest/developerguide/swf-dg-limits.html\n* Do you have metrics and alarms configured to check if your activity and decider workers are healthy?\n* Are you using workflow methods to perform long-running tasks? It is not recommended to do so. Replay can repeat that task multiple times, and even asynchronous workflow methods typically run more than once. Instead, use activities for long running tasks; replay executes activities only once.\n\n## SQS\n* Did you enable a re-drive policy for your service's SQS Queues to reduce the number of messages and mitigate the effects of poison pill messages?\n    * https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/working-with-messages.html#capturing-problematic-messages\n* Did you configure dead-letter queue to have a longer retention period than the original queue? The expiration of a message is always based on its original enqueue timestamp.\n    * https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/working-with-messages.html#setting-up-dead-letter-queue-retention\n* Do you have alarms in place for metrics published by SQS?\n    * https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-available-cloudwatch-metrics.html\n    * https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/set-cloudwatch-alarms-for-metrics.html\n\n## ECS\n* Did you configure your containers in the tasks to send log information to CloudWatch?\n    * https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definition_parameters.html#container_definition_storage\n    * https://docs.aws.amazon.com/AmazonECS/latest/developerguide/using_awslogs.html\n\n"}}}},
    "staticQueryHashes": []}