{
    "componentChunkName": "component---src-templates-md-template-js",
    "path": "/blogs/firebase-hands-on",
    "result": {"pageContext":{"html":"<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#official-tutorial-develop-locally-with-firebase\">Official tutorial: Develop locally with Firebase</a></p>\n<ul>\n<li><a href=\"#firestore-database\">Firestore Database</a></li>\n<li><a href=\"#cloud-function\">Cloud Function</a></li>\n<li><a href=\"#security-rules\">Security Rules</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"official-tutorial-develop-locally-with-firebase\" style=\"position:relative;\"><a href=\"#official-tutorial-develop-locally-with-firebase\" aria-label=\"official tutorial develop locally with firebase permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Official tutorial: <a href=\"https://firebase.google.com/learn/pathways/firebase-emulators#codelab-https://firebase.google.com/codelabs/firebase-emulator\">Develop locally with Firebase</a></h2>\n<ul>\n<li>The tutorial is based on this github repo: <a href=\"https://github.com/firebase/emulators-codelab\">https://github.com/firebase/emulators-codelab</a></li>\n<li>Install Firebase CLI: <code class=\"language-text\">npm install -g firebase-tools</code></li>\n<li>Initialize a Firebase project:\n<ul>\n<li>Log to <a href=\"https://console.firebase.google.com/u/0/\">Firebase console</a> to create a new project, copy the <strong>project ID</strong></li>\n<li><code class=\"language-text\">firebase login</code></li>\n<li><code class=\"language-text\">firebase use $project-id</code> to link to the cloud resources</li>\n</ul>\n</li>\n<li>Start the emulator: <code class=\"language-text\">firebase emulators:start --import=./seed</code></li>\n</ul>\n<blockquote>\n<p>How to generate testing data - \"./seed\"?</p>\n</blockquote>\n<ul>\n<li>If emlator starts failed, might because of the port number is already in used. Change the port number in <code class=\"language-text\">firebase.json</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Firebase use below way to fetch resources</span>\n<span class=\"token keyword\">const</span> auth <span class=\"token operator\">=</span> firebaseApp<span class=\"token punctuation\">.</span><span class=\"token function\">auth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> db <span class=\"token operator\">=</span> firebaseApp<span class=\"token punctuation\">.</span><span class=\"token function\">firestore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// This lines are added to public/js/homepage.js to create a short circuit </span>\n<span class=\"token comment\">// for local testing. </span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">.</span>hostname <span class=\"token operator\">===</span> <span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost detected!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    auth<span class=\"token punctuation\">.</span><span class=\"token function\">useEmulator</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://localhost:9099\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    db<span class=\"token punctuation\">.</span><span class=\"token function\">useEmulator</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>2 questions:</p>\n<ol>\n<li>how is the cloud resources setup?</li>\n<li>why auth and db has different ways to useEmulator?</li>\n</ol>\n</blockquote>\n<h3 id=\"firestore-database\" style=\"position:relative;\"><a href=\"#firestore-database\" aria-label=\"firestore database permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Firestore Database</h3>\n<ul>\n<li><strong>Firestore Database</strong> is a NoSQL DB but acting like a relational database\n<ul>\n<li>In the tutorial, there are 2 \"collections\", or tables: <code class=\"language-text\">items</code> and <code class=\"language-text\">carts</code></li>\n<li>item doc schema\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>description</th>\n<th>imgURL</th>\n<th>name</th>\n<th>price</th>\n</tr>\n</thead>\n</table>\n</li>\n<li>carts doc schema\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>itemCount</th>\n<th>ownerUID(same as id)</th>\n<th>totalPrice</th>\n<th>collection[item-id]</th>\n</tr>\n</thead>\n</table>\n</li>\n</ul>\n</li>\n<li>To access the data, the pattern is <code class=\"language-text\">db.collections(\"carts\").doc(uid).collection(\"items\").doc(item-id)</code></li>\n</ul>\n<blockquote>\n<p>How is the db schema defined? Or, is it required to be defined?</p>\n</blockquote>\n<h3 id=\"cloud-function\" style=\"position:relative;\"><a href=\"#cloud-function\" aria-label=\"cloud function permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cloud Function</h3>\n<ul>\n<li><strong>Cloud Functions</strong> can be set to listen to Firestore updating events. In local emulator, it works like:</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 431px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8b857c4224833205cd28459d5db47400/9cb4e/87bc9a17c0f38eea35af3040002aadc231e74b824dcebafbda88eb413c3acd62.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.16326530612245%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAADTUlEQVQ4y41TS2wbVRQ9dj5OM2k8CaQ0bovCAgRCEVQiSF0QQlWohGQEiKBKUBYghNhQyRuSHYEGRYQkRZWABliAKIiFBUJCcSAbNo1JHNsdSIgb17HnP/GMp2N7QLjjXvQcp4uIBU86Ou9z333n3vsu8D+HqqogogYURfnZNE0yTbNmmqZnmuZNttZ1XWa2rQDa/gN+dtjXBdAOQLFRH1ufCp/Bzs5OQdM0UlW1zphBURQqFos1ZtMFoBNAB4ADTWZ7gV1tLaBPAZoE7rv7MM4MD0DX9WupVIri8fg/a2trtUQiUVteXvZkWa6yGwebitjwNZk9EAh2AN++BBDdjvwhAP2O4+TL5TJVKhVivDe3LIv2FPr3payjCdCXAP2A9vrH3X/kJnsm2KPZzPrLqixNFbazk6qqvSNLhXdlcXtKUZRz4DjuYCgUCoyMjPgHBwdbw+Gwn+f5Lo7rDDDhRzjgeAgD1Tnuwq+RrrMAglNfLDaKw9TOXfjodrF+if3UUNMLoHsfeMAfbKoNNSNoB3AH29h6ERCnjw79+V7f268cA9bPHxvOvn/orYb16OgoNzMzw0cikSDD2NhYcHZ2lm/m9dDFF9of+Pti79zs822PjJ/yIzfR0UbzPOqf9IzTfF+N/poAfd5/nj7rU37sRguKxaJg23a+Wq1ed133erlc3rIsS9NU+TILI/pa4KR36XCF5juP06UDkKePtDzDA+NPgI8M4+Hw/cBzD+Loq0MYevoeAKwyhmFQMpmk1dVV2tjYIMdxqFQqre+GjkdZuojasPX9G9CySVxJXdv9T0D34InTbN4DYODs6+eAzc1NLx6Pe7FYzFtYWPCWlpZqzHEulxNCoX703nkX6E1gO/ENLn/9FT6c/qBV1/VoybIydsm6apqmcOOGna6UnauGYfwGwzAabcOU7oEp1nV9hYX87OnHfLe+e9z3+5WYL51KIh5f7jUMoyxJEomiSLIsUz6fp0KhwDqFUCgUTsiy/KQkSSf3oKrqU9ls9l7btlmbQdM0pNNpXyaTQTKZ7NE0TRUEgVZWVm4KguAlEgmPdYooinVIktS4sB+5XA6O48B1XeaMOcLi4iKi0ShnWZbIOqNardabfMt1XbJt2/sXFpgYpc9pVg8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"picture 55\"\n        title=\"picture 55\"\n        src=\"/static/8b857c4224833205cd28459d5db47400/9cb4e/87bc9a17c0f38eea35af3040002aadc231e74b824dcebafbda88eb413c3acd62.png\"\n        srcset=\"/static/8b857c4224833205cd28459d5db47400/86a2e/87bc9a17c0f38eea35af3040002aadc231e74b824dcebafbda88eb413c3acd62.png 245w,\n/static/8b857c4224833205cd28459d5db47400/9cb4e/87bc9a17c0f38eea35af3040002aadc231e74b824dcebafbda88eb413c3acd62.png 431w\"\n        sizes=\"(max-width: 431px) 100vw, 431px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>client requests to update the Firestore</li>\n<li>The Cloud Function <code class=\"language-text\">calculateCart</code> listens for any write events (create, update, or delete) that happen to cart items by using the <code class=\"language-text\">onWrite</code> trigger</li>\n<li>The <code class=\"language-text\">calculateCart</code> function reads all of the items in the cart and adds up the total quantity and price, then it updates the \"cart\" document with the new totals.</li>\n<li>The web frontend is subscribed to receive updates about changes to the cart. It gets a <strong>real-time</strong> update after the Cloud Function writes the new totals and updates the UI.</li>\n</ol>\n<ul>\n<li>Cloud Function supports unit test to interact with emulator firestore</li>\n</ul>\n<h3 id=\"security-rules\" style=\"position:relative;\"><a href=\"#security-rules\" aria-label=\"security rules permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Security Rules</h3>\n<ul>\n<li>Firebase uses <strong>Security Rules</strong> to control \"who has access to which data\"</li>\n<li>What if there are no match statements for an operation?\n<ul>\n<li>Rules deny by default. If an operation does not match any rules defined in the rules file, access will be denied.</li>\n<li><strong>Locked mode</strong>, or Production mode, is making that implicit denial an explicit denial by matching all documents and denying all access.</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>What does above 2nd point mean?</p>\n</blockquote>\n<ul>\n<li>Exmaple rule</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">rules_version = '2';\nservice cloud.firestore {\n    // path matcher\n    match /carts/{cartID} {\n      allow create: if request.auth.uid == request.resource.data.ownerUID;\n      allow read, update, delete: if request.auth.uid == resource.data.ownerUID;\n    }\n\n    // ...\n  }\n}</code></pre></div>\n<ul>\n<li>These rules now only allow read and write access by the cart owner.</li>\n<li>To verify incoming data and user's authentication, we use two objects that are available in the context of every rule:\n<ul>\n<li>The <code class=\"language-text\">request</code> object contains data and metadata about the operation that is being attempted.</li>\n<li>If a Firebase project is using Firebase Authentication, the request.auth object describes the user who is making the request.</li>\n</ul>\n</li>\n<li>What are the key differences between <code class=\"language-text\">resource</code> and <code class=\"language-text\">request.resource****</code>?\n<ul>\n<li><code class=\"language-text\">resource</code>: Represents the Firestore document in question <strong>before the current request</strong>. So for a create request, resource.data is always null because the document does not yet exist.</li>\n<li><code class=\"language-text\">request.resource</code>: Represents the Firestore document with the changes that the user <strong>wants to write</strong>. So for a create request, request.resource.data contains the proposed document.</li>\n</ul>\n</li>\n<li><strong>Rules don't cascade over subcollections</strong>\n<ul>\n<li>By default, the rules for a document don't cascade to documents in a subcollection.</li>\n<li>It's common to want slightly different rules for documents in a subcollection.</li>\n<li>If you want the documents in a subcollection to have the exact same rules, you can use the glob syntax to match all documents recursively: <code class=\"language-text\">match /{cartId=**}</code> (do this with care).</li>\n</ul>\n</li>\n<li>When can you use a resource or make a <code class=\"language-text\">get</code> call?\n<ul>\n<li>You can use the resource object when the required data is part of the current document being read/written.</li>\n<li>If you need data outside the current document, use a get statement. Note that these operations count towards your Firestore bill!</li>\n</ul>\n</li>\n<li>If we only want to test the permission, we can do it locally. But if we need to do unit test on the Cloud function logic, we have to setup the project ID so our test framework can make a call to GCP to trigger the function.</li>\n</ul>\n<blockquote>\n<p>Why the function cannot be run locally?</p>\n</blockquote>","date":"May 30, 2022","tags":["blog","note","firebase"],"title":"Firebase Hands-On","description":"Note to streamline the steps of learning Firebase framework."}},
    "staticQueryHashes": []}